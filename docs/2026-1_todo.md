# 2026 H1 任务目标（Sui Move Language）

最后更新：2026-02-21

## 1. 总目标
- 目标 A：插件兼容最新 JetBrains 平台，至少覆盖 `2025.3 (253.*)`，并完成 `2026.1 EAP (261.*)` 预验证。
- 目标 B：插件完整支持 Sui Move 2024 edition 核心语法与开发体验（解析、高亮、补全、诊断、快速修复、测试）。
- 目标 C：在保持现有用户可用性的前提下，减少回归风险，形成可持续发布流程。

## 2. 版本范围与验收门槛
- JetBrains 平台兼容：
  - `since-build` 维持现有最低支持范围（如无必要不抬高门槛）。
  - 对 `243+` 目标不设置 `until-build`（按 JetBrains 校验建议），并准备 `261.*` 预验证分支。
- Move 语言能力：
  - 默认支持 Move 2024 项目识别（从 `Move.toml` 的 `edition = "2024"`）。
  - 对 legacy/旧 edition 保持兼容，不引入破坏性解析回归。
- 发布门槛：
  - `./gradlew compileKotlin` 通过。
  - `./gradlew test` 通过。
  - `./gradlew verifyPlugin` 覆盖目标 IDE 版本并通过。
  - 至少 1 个真实 Sui Move 2024 示例项目手工验收通过。

## 3. 范围拆解（WBS）

### 3.1 平台与构建链升级
- 检查并更新 `build.gradle.kts` 中 IntelliJ Platform 相关配置。
- 校验 `gradle-*.properties` 与 `shortPlatformVersion/platformVersion` 的一致性。
- 更新 `src/main/resources/META-INF/plugin.xml` 的兼容范围。
- 跑通 `buildPlugin`、`verifyPlugin`，记录 API 变更修复点。

### 3.2 Move 2024 语法能力
- Lexer：
  - 新关键字处理：`mut`、`enum`、`match`、`type`（按 edition 控制）。
  - 关键字转义标识符（如反引号形式）识别。
- Parser/PSI（`src/main/grammars` + `src/main/gen`）：
  - `let mut`。
  - 方法调用语法（`v.push_back(x)`）与 `use fun` 别名路径。
  - 索引语法（`v[i]`、借用上下文）。
  - `enum` 声明与 `match` 分支模式。
- IDE 能力：
  - 高亮：新关键字、方法调用、enum variant。
  - 补全与解析：method-style 调用解析至原函数定义。
  - 诊断：edition 不匹配提示与建议。
  - Quick Fix：常见迁移修复（如 `let` -> `let mut`）。

### 3.3 质量保障与回归防线
- 按语法特性补齐最小回归测试集：
  - parser tests
  - annotator/inspection tests
  - completion/resolve tests
- 引入“新语法 + 旧语法”双向回归样例，避免破坏 legacy。
- 建立发布前检查清单（编译、测试、验证、手测）。

### 3.4 文档与发布
- 更新用户文档：
  - 支持的 JetBrains 版本范围
  - 支持的 Move edition 与迁移建议
- 发布说明明确：
  - 新增语法能力
  - 兼容范围
  - 已知限制与后续计划

## 4. 里程碑计划（建议）
- M1（第 1 周）：完成平台兼容参数更新与 verifier 基线通过。
- M2（第 2-3 周）：完成 Move 2024 核心语法解析链路（lexer/parser/psi）。
- M3（第 4 周）：完成 IDE 体验能力（高亮/补全/诊断/quick fix）与测试补齐。
- M4（第 5 周）：完成手测、文档、发布包，进入 Marketplace 发布流程。

## 5. 风险与对策
- 风险：JetBrains API 变更导致运行时兼容问题。
  - 对策：优先跑 Plugin Verifier，按报告逐项修复并加回归测试。
- 风险：`2026.1 EAP (261.*)` 后续更新可能再次影响 Grammar 生成链。
  - 对策：已升级 `org.jetbrains.grammarkit` 到 `2023.3.0.2` 并恢复 261 全链路校验（不再跳过 `generateLexer/generateParser`）；保留 eap-preverify 持续监控，若 EAP 破坏再临时降级为 smoke 并同步跟进修复。
- 风险：Move 2024 与 legacy 语法冲突。
  - 对策：edition 感知解析与关键字策略隔离，双轨测试。
- 风险：语法支持完成但 IDE 体验不完整。
  - 对策：把 completion/resolve/inspection 纳入同一里程碑验收，不拆成“后补”。

## 6. Definition of Done（DoD）
- 兼容范围配置生效并通过验证。
- Move 2024 核心语法在解析、高亮、补全、诊断上可用。
- 自动化测试覆盖关键新增场景且全部通过。
- 文档已更新，发布包可安装，版本说明清晰。
